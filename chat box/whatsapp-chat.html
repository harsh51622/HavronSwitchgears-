<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WhatsApp Enquiry Widget</title>
  <style>
    :root {
      --brand: #25D366;
      /* WhatsApp Green */
      --brand-2: #128C7E;
      /* Darker WhatsApp */
      --bg: #ffffff;
      --text: #1f2937;
      --muted: #6b7280;
      --shadow: 0 12px 30px rgba(0, 0, 0, .18), 0 4px 12px rgba(0, 0, 0, .10);
      --radius: 20px;
    }

    /* FAB */
    .chat-fab {
      position: fixed;
      right: 18px;
      bottom: 18px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--brand), var(--brand-2));
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow);
      cursor: pointer;
      z-index: 2;
      /* default low */
      transition: transform .15s ease, box-shadow .2s ease;
    }

    .chat-fab img {
      width: 28px;
      height: 28px;
      filter: invert(1);
    }

    .chat-fab:active {
      transform: scale(.96);
    }

    /* Panel */
    .chat-panel {
      position: fixed;
      right: 18px;
      bottom: 18px;
      width: 360px;
      height: 520px;
      background: var(--bg);
      color: var(--text);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      display: none;
      overflow: hidden;
      z-index: 1;
      /* üîπ default low */
    }

    @media (max-width: 480px) {
      .chat-panel {
        width: 92vw;
        height: 70vh;
        right: 4vw;
        bottom: 16px;
      }
    }

    .chat-header {
      background: linear-gradient(135deg, var(--brand), var(--brand-2));
      color: #fff;
      padding: 14px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .chat-header .title {
      font-weight: 700;
    }

    .chat-tabs {
      display: flex;
      gap: 6px;
      padding: 10px;
      background: #f8fafc;
      border-bottom: 1px solid #eef2f7;
    }

    .chat-tab {
      flex: 1;
      text-align: center;
      padding: 8px 10px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      color: #334155;
      background: #fff;
      border: 1px solid #e5e7eb;
    }

    .chat-tab.active {
      background: #dcf8c6;
      border-color: #25D366;
      color: #075e54;
    }

    .chat-body {
      height: calc(100% - 56px - 54px);
      display: flex;
    }

    .pane {
      flex: 1;
      display: none;
      height: 100%;
    }

    .pane.active {
      display: flex;
      flex-direction: column;
    }

    /* Messages */
    .messages {
      flex: 1;
      overflow: auto;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      background: #ece5dd;
    }

    .msg {
      max-width: 82%;
      padding: 10px 12px;
      border-radius: 14px;
      font-size: 14px;
    }

    .bot {
      background: #fff;
      align-self: flex-start;
    }

    .you {
      background: #dcf8c6;
      align-self: flex-end;
    }

    /* Input */
    .input-bar {
      border-top: 1px solid #eef2f7;
      background: #fff;
      padding: 10px;
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .input-bar input {
      flex: 1;
      height: 40px;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 0 12px;
      font-size: 14px;
      outline: none;
    }

    .btn {
      height: 40px;
      padding: 0 14px;
      border: none;
      border-radius: 12px;
      background: var(--brand);
      color: #fff;
      font-weight: 700;
      cursor: pointer;
    }

    /* Form */
    .form {
      flex: 1;
      overflow: auto;
      padding: 12px;
      background: #ece5dd;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .grid .full {
      grid-column: 1/-1;
    }

    label {
      font-size: 12px;
      margin: 6px 2px;
      display: block;
    }

    input,
    select,
    textarea {
      width: 100%;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 10px 12px;
      outline: none;
      background: #fff;
      font-size: 14px;
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }
  </style>
</head>

<body>

  <!-- FAB -->
  <div id="chatFab" class="chat-fab" title="WhatsApp Enquiry">
    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WA">
  </div>

  <!-- Panel -->
  <section id="chatPanel" class="chat-panel">
    <header class="chat-header">
      <div class="title">WhatsApp Enquiry</div>
      <button id="closeBtn" style="all:unset;cursor:pointer;color:#fff;font-size:18px;">‚úï</button>
    </header>

    <div class="chat-tabs">
      <div class="chat-tab active" data-tab="t-chat">Chat</div>
      <div class="chat-tab" data-tab="t-form">Enquiry</div>
    </div>

    <div class="chat-body">
      <!-- CHAT -->
      <div id="t-chat" class="pane active">
        <div id="messages" class="messages">
          <div class="msg bot">üëã Hi! Aap enquiry form bhi bhar sakte ho niche.</div>
        </div>
        <div class="input-bar">
          <input id="userInput" type="text" placeholder="Type here‚Ä¶" />
          <button id="sendBtn" class="btn">Send</button>
        </div>
      </div>

      <!-- FORM -->
      <div id="t-form" class="pane">
        <form id="enquiryForm" class="form">
          <div class="grid">
            <div>
              <label for="name">Name</label>
              <input id="name" name="name" required />
            </div>
            <div>
              <label for="phone">Phone</label>
              <input id="phone" name="phone" required />
            </div>
            <div>
              <label for="email">Email</label>
              <input id="email" name="email" type="email" />
            </div>
            <div>
              <label for="product">Product</label>
              <select id="product" name="product" required>
                <option value="">Choose‚Ä¶</option>
                <option>Switchgear Panel</option>
                <option>Cable Tray</option>
                <option>MCB / MCCB</option>
                <option>Custom Order</option>
              </select>
            </div>
            <div class="full">
              <label for="message">Other Query</label>
              <textarea id="message" name="message"></textarea>
            </div>
          </div>
          <div style="margin-top:10px; text-align:right;">
            <button type="submit" class="btn">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </section>

  <script>
    const fab = document.getElementById("chatFab");
    const panel = document.getElementById("chatPanel");
    const closeBtn = document.getElementById("closeBtn");
    const tabs = document.querySelectorAll(".chat-tab");
    const panes = document.querySelectorAll(".pane");
    const messages = document.getElementById("messages");
    const input = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");
    const enquiryForm = document.getElementById("enquiryForm");

    // üîπ FAB click -> panel open with high z-index
    fab.onclick = () => {
      fab.style.display = "none";
      panel.style.display = "block";
      panel.style.zIndex = "99999999999";
      panel.style.height="400px"
    };

    // üîπ Close button -> panel hide with low z-index
    closeBtn.onclick = () => {
      panel.style.display = "none";
      panel.style.zIndex = "1";
      fab.style.display = "flex";
        panel.style.height="0px"
    };

    function setTab(id) {
      tabs.forEach(t => t.classList.toggle("active", t.dataset.tab === id));
      panes.forEach(p => p.classList.toggle("active", p.id === id));
    }
    tabs.forEach(t => t.onclick = () => setTab(t.dataset.tab));

    function appendMsg(txt, who = "bot") {
      const div = document.createElement("div");
      div.className = "msg " + who;
      div.textContent = txt;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
    }
    sendBtn.onclick = () => {
      const val = input.value.trim();
      if (!val) return;
      appendMsg(val, "you");
      appendMsg("‚úÖ Got it! For details, please fill enquiry form.", "bot");
      input.value = "";
    };

    enquiryForm.onsubmit = async (e) => {
      e.preventDefault();
      const data = new FormData(enquiryForm);
      const res = await fetch("http://127.0.0.1:5000/submit", { method: "POST", body: data });
      const out = await res.json();
      if (out.status === "ok") {
        setTab("t-chat");
        appendMsg("üì© Enquiry saved successfully!", "bot");
        enquiryForm.reset();
      } else {
        appendMsg("‚ùå Error: " + out.msg, "bot");
      }
    };
  </script>
</body>

</html>